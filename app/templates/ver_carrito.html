{% extends "base.html" %}

{% block title %}Carrito de Compras - Verduler√≠a Fres{% endblock %}

{% block content %}
<div class="carrito-container">
    <h1>üõí Tu Carrito de Compras</h1>
    
    {% if carrito %}
    <div class="carrito-items">
        {% for producto_id, item in carrito.items() %}
        <div class="carrito-item" id="item-{{ producto_id }}">
            <div class="item-info">
                <h3>{{ item.nombre }}</h3>
                <p class="item-precio">${{ "%.2f"|format(item.precio|float) }} c/u</p>
            </div>
            
            <div class="item-controls">
                <div class="cantidad-controls">
                    <form method="POST" action="{{ url_for('actualizar_cantidad_carrito') }}" class="cantidad-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <input type="hidden" name="producto_id" value="{{ producto_id }}">
                        
                        <button type="submit" name="accion" value="decrementar" 
                                class="btn-cantidad {{ 'disabled' if item.cantidad <= 1 }}">
                            ‚àí
                        </button>
                        
                        <span class="cantidad-display">{{ item.cantidad }}</span>
                        
                        {% set stock = obtener_stock_actual(producto_id) %}
                        <button type="submit" name="accion" value="incrementar" 
                                class="btn-cantidad {{ 'disabled' if item.cantidad >= stock }}"
                                {{ 'disabled' if item.cantidad >= stock }}>
                            +
                        </button>
                    </form>
                </div>
                
                <div class="item-subtotal">
                    ${{ "%.2f"|format(item.precio|float * item.cantidad|int) }}
                </div>
                
                <form method="POST" action="{{ url_for('eliminar_del_carrito', producto_id=producto_id) }}" class="eliminar-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="btn-eliminar" onclick="return confirm('¬øEliminar {{ item.nombre }} del carrito?')">
                        üóëÔ∏è
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div class="carrito-totales">
        <div class="total-line">
            <span>Total:</span>
            <span class="total-precio">
                {% set total = namespace(value=0) %}
                {% for item in carrito.values() %}
                    {% set total.value = total.value + (item.precio|float * item.cantidad|int) %}
                {% endfor %}
                ${{ "%.2f"|format(total.value) }}
            </span>
        </div>
    </div>
    
    <div class="carrito-acciones">
        <form method="POST" action="{{ url_for('vaciar_carrito') }}" class="vaciar-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button type="submit" class="btn-vaciar" onclick="return confirm('¬øVaciar todo el carrito?')">
                üóëÔ∏è Vaciar Carrito
            </button>
        </form>
        
        <a href="{{ url_for('finalizar_compra') }}" class="btn-comprar">
            ‚úÖ Finalizar Compra
        </a>
    </div>
    
    {% else %}
    <div class="carrito-vacio">
        <div class="empty-state">
            <h2>üòî Tu carrito est√° vac√≠o</h2>
            <p>¬°Agrega algunos productos frescos!</p>
            <a href="{{ url_for('index') }}" class="btn-seguir-comprando">
                üõçÔ∏è Seguir Comprando
            </a>
        </div>
    </div>
    {% endif %}
</div>

<style>
/* ESTILOS DEL CARRITO */
.carrito-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
}

.carrito-container h1 {
    text-align: center;
    color: #2e7d32;
    margin-bottom: 2rem;
}

/* Items del carrito */
.carrito-items {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
    overflow: hidden;
}

.carrito-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid #e0e0e0;
}

.carrito-item:last-child {
    border-bottom: none;
}

.item-info h3 {
    margin: 0 0 0.5rem 0;
    color: #333;
}

.item-precio {
    color: #666;
    font-size: 0.9rem;
    margin: 0;
}

/* Controles de cantidad */
.item-controls {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.cantidad-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.cantidad-form {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0; /* Fix para alineaci√≥n */
}

.btn-cantidad {
    width: 35px;
    height: 35px;
    border: 2px solid #4caf50;
    background: white;
    color: #4caf50;
    border-radius: 6px;
    font-size: 1.2rem;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    padding: 0; /* Fix para centrado */
}

.btn-cantidad:hover:not(.disabled) {
    background: #4caf50;
    color: white;
}

.btn-cantidad.disabled {
    border-color: #ccc;
    color: #ccc;
    cursor: not-allowed;
    pointer-events: none; /* Evita clicks si est√° deshabilitado */
}

.cantidad-display {
    min-width: 40px;
    text-align: center;
    font-weight: 600;
    font-size: 1.1rem;
}

.item-subtotal {
    font-size: 1.2rem;
    font-weight: 700;
    color: #2e7d32;
    min-width: 90px;
    text-align: right;
}

.btn-eliminar {
    background: #ff4444;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 0.5rem;
    cursor: pointer;
    font-size: 1.2rem;
    transition: background 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
}

.btn-eliminar:hover {
    background: #cc0000;
}

/* Totales */
.carrito-totales {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}

.total-line {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1.3rem;
    font-weight: 700;
}

.total-precio {
    color: #2e7d32;
    font-size: 1.5rem;
}

/* Acciones */
.carrito-acciones {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    flex-wrap: wrap; /* Para m√≥viles */
}

.vaciar-form {
    flex: 1;
}

.btn-vaciar {
    width: 100%;
    padding: 1rem;
    background: #ff6b6b;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
}

.btn-vaciar:hover {
    background: #ff5252;
}

.btn-comprar {
    flex: 2; /* El bot√≥n comprar ocupa m√°s espacio */
    display: block;
    text-align: center;
    padding: 1rem;
    background: #4caf50;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 600;
    transition: background 0.3s ease;
}

.btn-comprar:hover {
    background: #45a049;
    color: white;
}

/* Carrito vac√≠o */
.carrito-vacio {
    text-align: center;
    padding: 4rem 2rem;
}

.empty-state h2 {
    color: #666;
    margin-bottom: 1rem;
}

.empty-state p {
    color: #888;
    margin-bottom: 2rem;
}

.btn-seguir-comprando {
    display: inline-block;
    padding: 1rem 2rem;
    background: #4caf50;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    transition: background 0.3s ease;
}

.btn-seguir-comprando:hover {
    background: #45a049;
}

/* Responsive */
@media (max-width: 768px) {
    .carrito-item {
        flex-direction: column;
        align-items: center; /* Centrado en m√≥vil */
        text-align: center;
        gap: 1rem;
    }
    
    .item-controls {
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .carrito-acciones {
        flex-direction: column-reverse; /* Comprar arriba */
    }
    
    .btn-vaciar, .btn-comprar {
        width: 100%;
    }
}
</style>
{% endblock %}